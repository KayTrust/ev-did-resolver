jasmine.DEFAULT_TIMEOUT_INTERVAL = 2000000000;
const DIDResolver = require('did-resolver').Resolver;
const EvResolver = require('../lib/index');
const host = 'https://api-gateway-dev.demo.kaytrust.id/backend/ms-besu-service';
// const host = 'http://localhost:8545';
const abiIM = [{'inputs':[],'payable':false,'stateMutability':'nonpayable','type':'constructor'},{'anonymous':false,'inputs':[{'indexed':false,'internalType':'address','name':'proxy','type':'address'},{'indexed':false,'internalType':'address','name':'newUser','type':'address'}],'name':'AccountRecovered','type':'event'},{'anonymous':false,'inputs':[{'indexed':false,'internalType':'address','name':'identity','type':'address'},{'indexed':false,'internalType':'address','name':'device','type':'address'},{'indexed':false,'internalType':'string','name':'cap','type':'string'},{'indexed':false,'internalType':'uint256','name':'start_date','type':'uint256'},{'indexed':false,'internalType':'uint256','name':'end_date','type':'uint256'}],'name':'CapSet','type':'event'},{'anonymous':false,'inputs':[{'indexed':false,'internalType':'address','name':'proxy','type':'address'}],'name':'IdentityCreated','type':'event'},{'anonymous':false,'inputs':[{'indexed':false,'internalType':'address','name':'proxy','type':'address'}],'name':'IdentityRegistered','type':'event'},{'anonymous':false,'inputs':[{'indexed':false,'internalType':'address','name':'proxy','type':'address'}],'name':'IdentityUnregistered','type':'event'},{'anonymous':false,'inputs':[{'indexed':true,'internalType':'string','name':'username','type':'string'},{'indexed':false,'internalType':'address','name':'from','type':'address'}],'name':'MnemonicSet','type':'event'},{'anonymous':false,'inputs':[{'indexed':false,'internalType':'address','name':'oldIdentityManager','type':'address'},{'indexed':false,'internalType':'address','name':'newIdentityManager','type':'address'}],'name':'Upgraded','type':'event'},{'constant':false,'inputs':[{'internalType':'bytes16','name':'keyMnemonic','type':'bytes16'},{'internalType':'bytes16','name':'keyProfile','type':'bytes16'},{'internalType':'string','name':'urlProfile','type':'string'},{'internalType':'string','name':'username','type':'string'},{'internalType':'string','name':'salt','type':'string'}],'name':'createIdentity','outputs':[{'internalType':'address','name':'','type':'address'}],'payable':false,'stateMutability':'nonpayable','type':'function'},{'constant':false,'inputs':[{'internalType':'contract Proxy','name':'identity','type':'address'},{'internalType':'address','name':'destination','type':'address'},{'internalType':'uint256','name':'value','type':'uint256'},{'internalType':'bytes','name':'data','type':'bytes'}],'name':'forwardTo','outputs':[],'payable':false,'stateMutability':'nonpayable','type':'function'},{'constant':true,'inputs':[{'internalType':'contract Proxy','name':'identity','type':'address'},{'internalType':'address','name':'device','type':'address'},{'internalType':'string','name':'cap','type':'string'}],'name':'hasCap','outputs':[{'internalType':'bool','name':'','type':'bool'}],'payable':false,'stateMutability':'view','type':'function'},{'constant':false,'inputs':[{'internalType':'contract Proxy','name':'identity','type':'address'},{'internalType':'address','name':'owner','type':'address'}],'name':'registerIdentity','outputs':[],'payable':false,'stateMutability':'nonpayable','type':'function'},{'constant':true,'inputs':[{'internalType':'address','name':'','type':'address'}],'name':'registered_identities','outputs':[{'internalType':'bool','name':'','type':'bool'}],'payable':false,'stateMutability':'view','type':'function'},{'constant':false,'inputs':[{'internalType':'contract Proxy','name':'identity','type':'address'},{'internalType':'address','name':'device','type':'address'},{'internalType':'string','name':'cap','type':'string'},{'internalType':'uint256','name':'start_date','type':'uint256'},{'internalType':'uint256','name':'end_date','type':'uint256'}],'name':'setCap','outputs':[],'payable':false,'stateMutability':'nonpayable','type':'function'},{'constant':false,'inputs':[{'internalType':'contract Proxy','name':'identity','type':'address'},{'internalType':'address','name':'device','type':'address'},{'internalType':'uint256','name':'start_date','type':'uint256'},{'internalType':'uint256','name':'end_date','type':'uint256'}],'name':'setDevice','outputs':[],'payable':false,'stateMutability':'nonpayable','type':'function'},{'constant':false,'inputs':[{'internalType':'contract Proxy','name':'identity','type':'address'}],'name':'unregisterIdentity','outputs':[],'payable':false,'stateMutability':'nonpayable','type':'function'},{'constant':false,'inputs':[{'internalType':'contract Proxy','name':'identity','type':'address'},{'internalType':'contract IdentityManager','name':'newIdentityManager','type':'address'}],'name':'upgrade','outputs':[],'payable':false,'stateMutability':'nonpayable','type':'function'}];
const abiProxy = [{"inputs":[{"internalType":"address","name":"firstOwner","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"destination","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"},{"indexed":false,"internalType":"bytes","name":"data","type":"bytes"}],"name":"Forwarded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnerAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"formerOwner","type":"address"}],"name":"OwnerRemoved","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"sender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Received","type":"event"},{"payable":true,"stateMutability":"payable","type":"fallback"},{"constant":false,"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"addOwner","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"destination","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"forward","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"internalType":"address","name":"addr","type":"address"}],"name":"isOwner","outputs":[{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"owners","outputs":[{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"renounce","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"}];
const addressIM = '0xa6b4540a2bfbe8663caa78027c83d0dcb1b7c837';

describe("EV Resolver", () => {

	let resolver;

	beforeAll(() => {
		const headers = [{ name: 'Authorization', value: 'Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI4OXp2WUZMZkJuREZwc2d2Rk1GQV9iMTc1M2Zma2dZV3hHZFpvajVueUFFIn0.eyJleHAiOjE2NTY0NzYwNzAsImlhdCI6MTY1NjQ0MDA3NiwiYXV0aF90aW1lIjoxNjU2NDQwMDcwLCJqdGkiOiI0MjUyY2IxMy00MDk0LTRkYWMtOThlNC1jNTI2ZTczMzNiODIiLCJpc3MiOiJodHRwczovL2F1dGgtZGV2LmRlbW8ua2F5dHJ1c3QuaWQvYXV0aC9yZWFsbXMvUHJvdmlkZXItVGVzdCIsImF1ZCI6WyJrdFByb3ZpZGVyU2hlbGwiLCJhY2NvdW50Il0sInN1YiI6IjdlNGQyYjQxLThiOTYtNGNhYS1iYWJkLTRjYmVkOTg5ZGYyMiIsInR5cCI6IkJlYXJlciIsImF6cCI6IndhbGxldENsaWVudCIsIm5vbmNlIjoiOGQzTUJjeUhEcWQ1c2JIYkx1emNfdyIsInNlc3Npb25fc3RhdGUiOiJjZGJmNzNmYS05ZTBlLTRmNGMtYTEwZi1kMzMxZGNhMDA3NDciLCJhY3IiOiIwIiwiYWxsb3dlZC1vcmlnaW5zIjpbIioiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtcHJvdmlkZXItdGVzdCIsIm9mZmxpbmVfYWNjZXNzIiwidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJrdFByb3ZpZGVyU2hlbGwiOnsicm9sZXMiOlsibW9kdWxlOjppZGVudGl0eSIsIm1vZHVsZTo6cHJlc2VudGF0aW9uIiwibW9kdWxlOjpjcmVkZW50aWFsIl19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX19LCJzY29wZSI6Im9wZW5pZCIsInNpZCI6ImNkYmY3M2ZhLTllMGUtNGY0Yy1hMTBmLWQzMzFkY2EwMDc0NyJ9.FfNp8uTRhrZC2XqLjoItazwU9iEFY2kQ2LODpNOuzSo4HHQ2Fnjg9Mei4636GjgcZ2EqnB7mOYnQeV-_bah94_A2lixTElHR0meBmoVJ2u5FUaPerKpIISK7TiLgTcm2vAbS7nmPlHE0u8z4RXAjdCuJccwaNYrlMoHjddJdNX7wisdtZCLkUmRFvwuT79UoBftZ5CLqdP8QvwLCmw4VSWAotKK8UkF45uK0Qy59xlUg6k3FGoE13Kj23XCp0d2TlIeqyQdfsgnblFFkwTFcPU2uVHNiZc0uXsmgIIY5lN4i8SAn9KuHn2_3ConymvHITjWMarNRFEfY9sY9VeJppQ' }];
		EvResolver.setConfigResolver(host, abiIM, addressIM, abiProxy, headers);
		const evResolver = EvResolver.getResolver();
		resolver = new DIDResolver(evResolver);
	});

    it('DIDResolver return a document', () => {
		return resolver.resolve('did:ev:cwML5JSTFLtHJreQEUULYGGubzBBt7tfKNwJu')
		.then(doc => {
			console.log(doc);
			expect(doc).not.toBeNull();
		});
	});

	it('DIDResolver return a document with options', () => {
		const options = {
			findEvents: true,
			keys: [
				{ 
					identity: '0x1f70a7fe820932188cb353010d06e524b7d5b19e',
					device: '0x2FD3a895C728652FFe586b0B9e07B47edfC6e3FD',
					cap: 'fw',
				}
			]
		}
		return resolver.resolve('did:ev:cwML5JSTFLtHJreQEUULYGGubzBBt7tfKNwJu', options)
		.then(doc => {
			console.log(doc);
			expect(doc).not.toBeNull();
		});
	});
});